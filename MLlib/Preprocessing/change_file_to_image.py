#!encoding:utf-8

import numpy
from PIL import Image
import binascii
import os


class getMatrix_from_bin(object):
    '''
    this will get a image which is 30*30 px from file 
    and we should drop the PE header and begain of the .text 
    '''
    def __init__(self,filename,wigth=256,file_o=None):
        self.filename=filename
        self.wigth=wigth
        self.file_o=file_o

    def get_bin_from_file(self):
        with open(self.filename,'rb') as fp:
            content=fp.read()
        hexst=binascii.hexlify(content)
        fh = numpy.array([int(hexst[i:i+2],16) for i in range(0, len(hexst), 2)])#split by byte
        rn = len(fh)/self.wigth
        fh=numpy.reshape(fh[:rn*self.wigth],(-1,self.wigth))
        fp=numpy.uint8(fh)
        return fh
    
    def save_image(self):
        if not file_o:
            raise ValueError("you have not point the output filder")
        im=Image.fromarray(self.get_bin_from_file())
        im.show()
        im.save(os.path.join(self.file_o,"%s.png"%(os.path.basename(self.filename))),'png')
    
def show_iamge(FilePath):
    img=Image.open(FilePath)
    img.show()

if __name__ == "__main__":
    file_path="D:/work/sample_analysis/20171130/20171130/a6/config_20171127082139.exe"
    file_o="D:/work/sample_analysis/39.106.102.176/b89b22c80df07718c4bd16d2f59671d59867d6e7_20180106073351"
    print getMatrix_from_bin(file_path,file_o=file_o).get_bin_from_file()
    # show_iamge(os.path.join(file_o,"URGENT ORDER.exe.png"))
    